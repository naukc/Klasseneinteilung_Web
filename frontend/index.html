<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Klasseneinteilung</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <h1>Klasseneinteilung Grundschule</h1>
            <p class="subtitle">Automatische Einteilung mit Qualit√§tspr√ºfung</p>
        </header>

        <!-- Steuerung -->
        <section class="controls card">
            <div class="controls-row">
                <div class="upload-area">
                    <input type="file" id="fileInput" accept=".xlsx,.xls,.ods" hidden>
                    <button class="btn btn-primary" id="uploadBtn">
                        <span class="icon">üìÅ</span> Datei ausw√§hlen
                    </button>
                    <span class="file-name" id="fileName">Keine Datei ausgew√§hlt</span>
                </div>

                <div class="config-group">
                    <label for="anzahlKlassen">Klassen:</label>
                    <input type="number" id="anzahlKlassen" value="5" min="2" max="26">
                </div>

                <div class="config-group">
                    <label for="iterationen">Iterationen:</label>
                    <input type="number" id="iterationen" value="10000" min="1000" step="1000">
                </div>

                <button class="btn btn-success" id="startBtn" disabled>
                    <span class="icon">‚ñ∂</span> Einteilung starten
                </button>

                <button class="btn btn-secondary" id="exportBtn" disabled>
                    <span class="icon">üíæ</span> Excel-Export
                </button>
            </div>

            <!-- Vorlage herunterladen -->
            <div class="vorlage-bereich">
                <span class="vorlage-label">Vorlage herunterladen:</span>
                <a href="/api/vorlage?format=xlsx" class="vorlage-link" download>Excel (.xlsx)</a>
                <span class="vorlage-trenner">|</span>
                <a href="/api/vorlage?format=ods" class="vorlage-link" download>LibreOffice (.ods)</a>
                <span class="vorlage-hinweis">Numbers-Nutzer: .xlsx direkt in Numbers √∂ffnen</span>
            </div>

            <div id="uploadInfo" class="upload-info hidden"></div>
        </section>

        <!-- Spalten-Mapping -->
        <section class="mapping-section card hidden" id="mappingSection">
            <h2>Spalten zuordnen</h2>
            <p class="mapping-hint">Einige Spalten konnten nicht automatisch erkannt werden. Bitte ordnen Sie die Spalten aus Ihrer Datei den erwarteten Feldern zu.</p>
            <div class="mapping-grid" id="mappingGrid"></div>
            <div class="mapping-actions">
                <button class="btn btn-success" id="mappingConfirmBtn">Zuordnung √ºbernehmen</button>
            </div>
        </section>

        <!-- Sch√ºlerliste bearbeiten (W√ºnsche / Trennungen) -->
        <section class="schueler-edit-section card hidden" id="schuelerEditSection">
            <div class="schueler-edit-header">
                <div>
                    <h2>Sch√ºlerliste <span class="badge badge-info" id="schuelerAnzahlBadge"></span></h2>
                    <p class="subtitle">W√ºnsche und Trennungen zuordnen (optional)</p>
                </div>
                <button class="btn btn-success" id="confirmDataBtn">
                    <span class="icon">‚úì</span> Daten best√§tigen & weiter
                </button>
            </div>
            <div class="table-wrapper">
                <table class="schueler-edit-table" id="schuelerEditTable">
                    <thead>
                        <tr>
                            <th class="col-nr">#</th>
                            <th class="col-name">Name</th>
                            <th class="col-geschlecht">Geschl.</th>
                            <th class="col-auff">Auff.</th>
                            <th class="col-migration">Migration</th>
                            <th class="col-wuensche">Wunschpartner (max. 4)</th>
                            <th class="col-trennung">Trennen von (max. 4)</th>
                        </tr>
                    </thead>
                    <tbody id="schuelerEditBody"></tbody>
                </table>
            </div>
        </section>

        <!-- Ladebalken -->
        <div class="progress-container hidden" id="progressContainer">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p class="progress-text" id="progressText">Optimierung l√§uft...</p>
        </div>

        <!-- Gesamt-Ampel -->
        <section class="ampel-banner hidden" id="ampelBanner">
            <div class="ampel-icon" id="ampelIcon"></div>
            <div class="ampel-text" id="ampelText"></div>
            <div class="drag-hint" id="dragHint">Sch√ºler per Drag & Drop zwischen Klassen verschieben</div>
        </section>

        <!-- Pr√ºfungs-Dashboard -->
        <section class="dashboard hidden" id="dashboard">
            <h2>Qualit√§tspr√ºfung</h2>

            <!-- Zusammenfassung -->
            <div class="summary-cards" id="summaryCards"></div>

            <!-- Klassen-Tabelle -->
            <div class="card">
                <h3>Pr√ºfergebnisse pro Klasse</h3>
                <div class="table-wrapper">
                    <table class="pruefung-table" id="pruefungTable">
                        <thead></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Nicht erf√ºllte W√ºnsche -->
            <div class="card" id="wuenscheCard">
                <h3>Nicht erf√ºllte W√ºnsche <span class="badge" id="wuenscheBadge"></span></h3>
                <div class="table-wrapper">
                    <table class="wuensche-table" id="wuenscheTable">
                        <thead>
                            <tr>
                                <th>Sch√ºler</th>
                                <th>Klasse</th>
                                <th>Wunschpartner</th>
                                <th>Klasse Wunschpartner</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Klassenlisten mit Drag & Drop -->
        <section class="klassen-section hidden" id="klassenSection">
            <h2>Klassenlisten <span class="hint">(Drag & Drop zum Verschieben)</span></h2>
            <div class="klassen-grid" id="klassenGrid"></div>
        </section>
    </div>

    <script src="app.js"></script>
</body>
</html>
